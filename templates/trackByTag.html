{% extends 'nav.html' %}

{% block content %}
<div class="container">

    {% if not tags %}
        <h1>No Employees in database, Please add some</h1>
    {% else %}
        <form action="{% url 'trackByTag' %}" method="POST">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group col-md-12">
                    <label for="Tag">Select Tag or whatever</label>
                    <select name="Tag" id="Tag" class="form-control">
                        <!-- <option selected>select from the dropdown</option> -->
                        {% for t in tags %}
                            <option>{{ t }}</option>
                        {% endfor %}                    
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">View Expense</button>
        </form>
            {% if expenses %}
                Tag is {{name}}
                <table>
                    <tr>
                        <th> Amount </th>
                        <th> Id</th>
                        <th> Time</th>
                    </tr>
                    {% for e in expenses %}
                        <tr>
                            <td>
                                {{e.amount}}
                            </td>
                            <td>
                                {{e.id}}
                            </td>
                            <td>
                                {{e.time}}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                <br/><br/>
                Total is {{sum}}
           

            {% endif %}
    {% endif %}
    <div class="row">
        <div id="piechart"></div>
    </div>

</div>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    // Load google charts
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    // Draw the chart and set the chart values
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Tag', 'Total Expense'],
            {% for k, v in tagExpense.items %}
                ["{{k}}", {{ v }}],
            {% endfor %}
        ]);

    // Optional; add a title and set the width and height of the chart
    var options = { 'title': 'Total Expenses by Tag', 'width': 800, 'height': 600 };

    // Display the chart inside the <div> element with id="piechart"
    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(data, options);
    }
</script>

{% endblock %}