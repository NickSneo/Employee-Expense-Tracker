{% extends 'nav.html' %}

{% block content %}
<div class="container">

    {% if not empIds %}
    <h1>No Employees in database, Please add some</h1>
    {% else %}
    <form action="{% url 'trackByEmp' %}" method="POST">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="EmpId">Select Employee ID</label>
                <select name="EmpId" id="EmpId" class="form-control">
                    <!-- <option selected>select from the dropdown</option> -->
                    {% for e in empIds %}
                        <option>{{ e }}</option>
                    {% endfor %}                    
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">View Expense</button>
    </form>
        {% if expenses %}
            Employee is {{name}}
            <table>
                <tr>
                    <th> Amount </th>
                    <th> Tag</th>
                    <th> Time</th>
                </tr>
                {% for e in expenses %}
                    <tr>
                        <td>
                            {{e.amount}}
                        </td>
                        <td>
                            {{e.tag}}
                        </td>
                        <td>
                            {{e.time}}
                        </td>
                    </tr>
                {% endfor %}
            </table>
            <br/><br/>
            Salary is {{salary}}<br/>
            Other expenses is {{total}}
            <div class="row">
                <div id="piechart"></div>
            </div>
        {% endif %}
    {% endif %}
    
</div>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    // Load google charts
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    // Draw the chart and set the chart values
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Tag', 'Total Expense'],
            {% for k, v in tagExpense.items %}
                ["{{k}}", {{ v }}],
            {% endfor %}
        ]);

    // Optional; add a title and set the width and height of the chart
    var options = { 'title': 'Total Expenses by Tag', 'width': 800, 'height': 600 };

    // Display the chart inside the <div> element with id="piechart"
    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(data, options);
    }
</script>
{% endblock %}